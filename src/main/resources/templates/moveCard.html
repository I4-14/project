
<html><head><base href="https://websim.ai"/><title>KanbanFlow - Your Board</title><style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f0f2f5;
    margin: 0;
    padding: 0;
  }
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  h1 {
    color: #333;
    margin: 0;
  }
  .invite-btn {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 4px;
  }
  .board {
    display: flex;
    gap: 20px;
    overflow-x: auto;
    padding-bottom: 20px;
    min-height: 600px;
  }
  .column {
    background-color: #ebecf0;
    border-radius: 4px;
    width: 300px;
    min-width: 300px;
    padding: 10px;
    display: flex;
    flex-direction: column;
  }
  .column-header {
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 10px;
    padding: 10px 0;
  }
  .task {
    background-color: white;
    border-radius: 4px;
    padding: 10px;
    margin-bottom: 10px;
    cursor: move;
    box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  }
  .task:hover {
    box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
  }
  .task-title {
    font-weight: bold;
    margin-bottom: 5px;
  }
  .task-description {
    font-size: 14px;
    color: #666;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
    border-radius: 4px;
  }
  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }
  .add-column-btn, .add-card-btn {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 4px;
  }
  .add-column-btn {
    display: block;
    margin: 20px auto;
    font-size: 18px;
    padding: 15px 30px;
  }
  .add-card-btn {
    width: 100%;
    margin-top: auto;
  }
</style></head><body>
<div class="container">
  <div class="header">
    <h1>Your Kanban Board</h1>
    <button class="invite-btn">Invite Team Members</button>
  </div>
  <div class="board">
    <div class="column" id="done">

      <div class="task" draggable="true" data-id="10">
        <div class="task-title">Update dependencies</div>
        <div class="task-description">Upgrade all packages to latest versions</div>
      </div>
      <button class="add-card-btn">+ Add Card</button>
    </div>
  </div>
  <button class="add-column-btn">+ Add Column</button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var boardContainer = document.querySelector('.board');
    var id = 1;

    // Function to fetch board data and update UI
    function fetchAndRenderBoard() {
      fetch(`http://localhost:8080/api/boards/${id}`)
      .then(function (response) {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(function (data) {
        console.log('Data:', data);

        // Clear existing board content
        boardContainer.innerHTML = '';

        var columnsList = data.data.columnsList;

        columnsList.forEach(function (columnData) {
          var column = columnData.column;

          var columnElement = document.createElement('div');
          columnElement.classList.add('column');
          columnElement.id = 'column-' + column.id;

          var columnHeader = document.createElement('div');
          columnHeader.classList.add('column-header');
          columnHeader.textContent = column.category; // Display category as column header
          columnElement.appendChild(columnHeader);

          column.cards.forEach(function (card) {
            var cardElement = createCardElement(card);
            columnElement.appendChild(cardElement);
          });

          // Append column element to board container
          boardContainer.appendChild(columnElement);
        });

        // Event listener for drop operation
        boardContainer.addEventListener('dragover', function (event) {
          event.preventDefault();
        });

        boardContainer.addEventListener('drop', function (event) {
          event.preventDefault();
          var taskId = event.dataTransfer.getData('text/plain');
          var targetTask = event.target.closest('.task');

          if (targetTask) {
            var newPosition = Array.from(targetTask.parentNode.children).indexOf(targetTask) - 1; // 1-based index
            moveCardPosition(taskId, newPosition);
          }
        });

      })
      .catch(function (error) {
        console.error('Error fetching data:', error);
      });
    }

    // Initial fetch and render
    fetchAndRenderBoard();

    // Function to move card position
    function moveCardPosition(cardId, newPosition) {
      fetch(`http://localhost:8080/api/columns/cards/${cardId}/position?newPosition=${newPosition}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
      })
      .then(function (response) {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        // Fetch and render board again after successful update
        fetchAndRenderBoard();
      })
      .catch(function (error) {
        console.error('Error updating card position:', error);
      });
    }

    function createCardElement(card) {
      var cardElement = document.createElement('div');
      cardElement.classList.add('task');
      cardElement.dataset.id = card.id;

      var cardTitle = document.createElement('div');
      cardTitle.classList.add('task-title');
      cardTitle.textContent = card.title;
      cardElement.appendChild(cardTitle);

      var cardDescription = document.createElement('div');
      cardDescription.classList.add('task-description');
      cardDescription.textContent = card.content;
      cardElement.appendChild(cardDescription);

      // Make the task draggable
      cardElement.setAttribute('draggable', 'true');
      cardElement.addEventListener('dragstart', function (event) {
        event.dataTransfer.setData('text/plain', card.id.toString());
        setTimeout(function () {
          cardElement.style.opacity = '0.5';
        }, 0);
      });

      cardElement.addEventListener('dragend', function () {
        setTimeout(function () {
          cardElement.style.opacity = '1';
        }, 0);
      });

      return cardElement;
    }
  });

  // document.querySelectorAll('.task').forEach(task => {
  //   task.addEventListener('dragstart', (e) => {
  //     draggedTask = e.target;
  //     e.dataTransfer.setData('text/plain', e.target.id);
  //     setTimeout(() => {
  //       e.target.style.opacity = '0.5';
  //     }, 0);
  //     $(this).addClass('dragging');
  //   });
  //
  //   task.addEventListener('dragend', (e) => {
  //
  //     e.target.style.opacity = '1';
  //     $(this).removeClass('dragging');
  //   });
  //
  //   // Click to view details
  //   task.addEventListener('click', (e) => {
  //     const modal = document.getElementById('taskModal');
  //     const modalTitle = document.getElementById('modalTitle');
  //     const modalDescription = document.getElementById('modalDescription');
  //     const modalStatus = document.getElementById('modalStatus');
  //
  //     modalTitle.textContent = e.currentTarget.querySelector('.task-title').textContent;
  //     modalDescription.textContent = e.currentTarget.querySelector('.task-description').textContent;
  //     modalStatus.textContent = 'Status: ' + e.currentTarget.closest('.column').querySelector('.column-header').textContent;
  //
  //     modal.style.display = 'block';
  //   });
  // });

  document.querySelectorAll('.column').forEach(column => {
    column.addEventListener('dragover', (e) => {
      e.preventDefault();
      const afterElement = getDragAfterElement(column, e.clientY);
      const task = document.querySelector('.task.dragging');
      if (afterElement == null) {
        column.insertBefore(draggedTask, column.querySelector('.add-card-btn'));
      } else {
        column.insertBefore(draggedTask, afterElement);
      }
    });

    column.addEventListener('dragenter', (e) => {
      e.preventDefault();
      column.classList.add('drag-over');
    });

    column.addEventListener('dragleave', () => {
      column.classList.remove('drag-over');
    });

    column.addEventListener('drop', (e) => {
      e.preventDefault();
      column.classList.remove('drag-over');
      if (draggedTask) {
        const afterElement = getDragAfterElement(column, e.clientY);
        if (afterElement == null) {
          column.insertBefore(draggedTask, column.querySelector('.add-card-btn'));
        } else {
          column.insertBefore(draggedTask, afterElement);
        }
        draggedTask = null;
      }
    });
  });

  function getDragAfterElement(column, y) {
    const draggableElements = [...column.querySelectorAll('.task:not(.dragging)')];

    return draggableElements.reduce((closest, child) => {
      const box = child.getBoundingClientRect();
      const offset = y - box.top - box.height / 2;
      if (offset < 0 && offset > closest.offset) {
        return { offset: offset, element: child };
      } else {
        return closest;
      }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
  }

  // // Add new column functionality
  // document.querySelector('.add-column-btn').addEventListener('click', () => {
  //   const board = document.querySelector('.board');
  //   const newColumn = document.createElement('div');
  //   newColumn.className = 'column';
  //   newColumn.innerHTML = `
  //       <div class="column-header">New Column</div>
  //       <button class="add-card-btn">+ Add Card</button>
  //     `;
  //   board.insertBefore(newColumn, document.querySelector('.add-column-btn'));
  //
  //   // Add event listeners to the new column
  //   newColumn.addEventListener('dragover', (e) => {
  //     e.preventDefault();
  //     const afterElement = getDragAfterElement(newColumn, e.clientY);
  //     const task = document.querySelector('.task.dragging');
  //     if (afterElement == null) {
  //       newColumn.insertBefore(draggedTask, newColumn.querySelector('.add-card-btn'));
  //     } else {
  //       newColumn.insertBefore(draggedTask, afterElement);
  //     }
  //   });
  //
  //   newColumn.addEventListener('dragenter', (e) => {
  //     e.preventDefault();
  //     newColumn.classList.add('drag-over');
  //   });
  //
  //   newColumn.addEventListener('dragleave', () => {
  //     newColumn.classList.remove('drag-over');
  //   });
  //
  //   newColumn.addEventListener('drop', (e) => {
  //     e.preventDefault();
  //     newColumn.classList.remove('drag-over');
  //     if (draggedTask) {
  //       const afterElement = getDragAfterElement(newColumn, e.clientY);
  //       if (afterElement == null) {
  //         newColumn.insertBefore(draggedTask, newColumn.querySelector('.add-card-btn'));
  //       } else {
  //         newColumn.insertBefore(draggedTask, afterElement);
  //       }
  //       draggedTask = null;
  //     }
  //   });
  //
  //   // Add event listener to the new add-card button
  //   newColumn.querySelector('.add-card-btn').addEventListener('click', addNewCard);
  // });
  //
  // // Add new card functionality
  // function addNewCard(e) {
  //   const column = e.target.closest('.column');
  //   const newTask = document.createElement('div');
  //   newTask.className = 'task';
  //   newTask.draggable = true;
  //   newTask.dataset.id = Date.now();  // Use timestamp as a simple unique id
  //   newTask.innerHTML = `
  //       <div class="task-title">New Task</div>
  //       <div class="task-description">Add description here</div>
  //     `;
  //   column.insertBefore(newTask, e.target);
  //
  //   // Add event listeners to the new task
  //   newTask.addEventListener('dragstart', (e) => {
  //     draggedTask = e.target;
  //     e.dataTransfer.setData('text/plain', e.target.id);
  //     setTimeout(() => {
  //       e.target.style.opacity = '0.5';
  //     }, 0);
  //   });
  //
  //   newTask.addEventListener('dragend', (e) => {
  //     e.target.style.opacity = '1';
  //   });
  //
  //   newTask.addEventListener('click', (e) => {
  //     const modal = document.getElementById('taskModal');
  //     const modalTitle = document.getElementById('modalTitle');
  //     const modalDescription = document.getElementById('modalDescription');
  //     const modalStatus = document.getElementById('modalStatus');
  //
  //     modalTitle.textContent = e.currentTarget.querySelector('.task-title').textContent;
  //     modalDescription.textContent = e.currentTarget.querySelector('.task-description').textContent;
  //     modalStatus.textContent = 'Status: ' + e.currentTarget.closest('.column').querySelector('.column-header').textContent;
  //
  //     modal.style.display = 'block';
  //   });
  // }
  //
  // // Add event listeners to all add-card buttons
  // document.querySelectorAll('.add-card-btn').forEach(btn => {
  //   btn.addEventListener('click', addNewCard);
  // });
  //
  // // Invite button functionality (you can customize this as needed)
  // document.querySelector('.invite-btn').addEventListener('click', () => {
  //   alert('Invite functionality will be implemented here!');
  // });
</script>
</body></html>
