<html w-tid="0"><head w-tid="1"><base href w-tid="2"/>
    <link rel="stylesheet" href="https://party.websim.ai/fonts.css?v=e2bf16830bce9b802248229ee8d60119235bacd2">
    <link rel="stylesheet" href="https://party.websim.ai/ctxmenu.css?v=e2bf16830bce9b802248229ee8d60119235bacd2">
    <script class="websim-injected">__WEBSIM_DATA__={"locationKey":"_tmk11himl4b","titleKey":"_l25ow9kfbu","id":"rGHu8yalo9dY7hlUo","url":"https://websim.ai","version":"e2bf16830bce9b802248229ee8d60119235bacd2","method":"eval","command":"오른쪽 위에 있으면 좋겠어"}</script>
    <script class="websim-injected" src="https://party.websim.ai/dist/index.js?v=e2bf16830bce9b802248229ee8d60119235bacd2"></script>
    <title w-tid="3">KanbanFlow - Invitations</title><style w-tid="4">
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .invitation-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .invitation-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .invitation-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 10px 0;
            color: #333;
        }

        .invitation-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .invitation-status {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .status-pending {
            color: #f39c12;
        }

        .status-accepted {
            color: #2ecc71;
        }

        .status-declined {
            color: #e74c3c;
        }

        .invitation-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .btn-accept {
            background-color: #2ecc71;
            color: white;
        }

        .btn-accept:hover {
            background-color: #27ae60;
        }

        .btn-decline {
            background-color: #e74c3c;
            color: white;
        }

        .btn-decline:hover {
            background-color: #c0392b;
        }

        .status-icon {
            margin-right: 5px;
        }
        .back-btn {
            background-color: #607D8B;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
            position: absolute;
            top: 5px;
            right: 0;
        }
        .back-btn:hover {
            background-color: #546E7A;
        }
    </style></head><body w-tid="5">
<div class="container" w-tid="6">
    <button class="back-btn" onclick="window.location.href='http://localhost:8080/view/index'" w-tid="7">Back</button>
    <h1 w-tid="8">Your Invitations</h1>
    <div class="invitation-list" id="invitationList" w-tid="9">
        <!-- Invitations will be dynamically added here -->
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js" w-tid="11"></script>

<script w-tid="12">
    $(document).ready(function() {
        const token = Cookies.get('Authorization');
        console.log(token);
        if (!token) {
            window.location.href = 'http://localhost:8080/'; // 토큰이 없으면 로그인 페이지로 리다이렉트
            return;
        }

        // 초대 데이터를 API에서 가져옴
        $.ajax({
            url: 'http://localhost:8080/api/invite',
            type: 'GET',
            headers: {
                'Authorization': token
            },
            success: function(data) {
                const invitationList = $('#invitationList');
                data.data.forEach(function(invitation) {
                    const card = $('<div>').addClass('invitation-card')
                        .html(`
                                          <h2 class="invitation-title">${invitation.title}</h2>
                                          <p class="invitation-description">${invitation.description}</p>
                                          <p class="invitation-status status-${invitation.status.toLowerCase()}">
                                              ${getStatusIcon(invitation.status)}
                                              Status: ${invitation.status}
                                          </p>
                                          ${getActionButtons(invitation.status, invitation.id)}
                                      `);
                    invitationList.append(card);

                    // 수락 및 거절 버튼에 이벤트 리스너 추가
                    card.find('.btn-accept, .btn-decline').click(handleInvitationResponse);
                });
            },
            error: function(xhr, status, error) {
                console.error('Error fetching data:', error);
                // 에러 처리 (예: 에러 메시지 표시)
            }
        });
    });

    function getStatusIcon(status) {
        switch(status) {
            case 'PENDING':
                return '<span class="status-icon">⏳</span>';
            case 'ACCEPTED':
                return '<span class="status-icon">✅</span>';
            case 'DECLINED':
                return '<span class="status-icon">❌</span>';
            default:
                return '';
        }
    }

    function getActionButtons(status, id) {
        if (status === 'PENDING') {
            return `
            <div class="invitation-actions">
                <button class="btn btn-accept" data-id="${id}">Accept</button>
                <button class="btn btn-decline" data-id="${id}">Decline</button>
            </div>
        `;
        }
        return '';
    }

    function handleInvitationResponse(event) {
        const button = $(event.target);
        const invitationId = button.data('id');
        const action = button.hasClass('btn-accept') ? 'accept' : 'decline';
        const card = button.closest('.invitation-card');
        const statusElement = card.find('.invitation-status');

        // 여기서 실제로는 서버에 요청을 보내야 합니다.
        // 이 예제에서는 즉시 UI를 업데이트합니다.
        if (action === 'accept') {
            statusElement.html(`${getStatusIcon('ACCEPTED')}Status: ACCEPTED`);
            statusElement.removeClass().addClass('invitation-status status-accepted');
        } else {
            statusElement.html(`${getStatusIcon('DECLINED')}Status: DECLINED`);
            statusElement.removeClass().addClass('invitation-status status-declined');
        }

        // 버튼 제거
        card.find('.invitation-actions').remove();
    }
</script>
</body></html>